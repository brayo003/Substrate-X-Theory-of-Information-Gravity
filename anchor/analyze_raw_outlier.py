import numpy as np

# Read the data you posted (first ~200 lines)
raw_data = np.array([
-1.061416e-19, -7.403172e-20, -6.427127e-20, -7.385708e-20, -9.262166e-20,
-9.770939e-20, -5.911232e-20, -6.672249e-20, -1.112415e-19, -9.021646e-20,
-6.579665e-20, -8.140052e-20, -9.518315e-20, -1.060168e-19, -7.869337e-20,
-6.470522e-20, -1.098489e-19, -1.062445e-19, -7.302724e-20, -8.431381e-20,
-9.747191e-20, -1.084212e-19, -9.574852e-20, -6.792169e-20, -1.020017e-19,
-1.240098e-19, -8.517474e-20, -8.091954e-20, -1.033663e-19, -1.109504e-19,
-1.051680e-19, -7.796887e-20, -9.263219e-20, -1.310871e-19, -1.014874e-19,
-7.984178e-20, -1.082327e-19, -1.157438e-19, -1.109982e-19, -9.293958e-20,
-8.852795e-20, -1.280129e-19, -1.198636e-19, -8.374551e-20, -1.031172e-19,
-1.216313e-19, -1.165437e-19, -1.028324e-19, -9.236602e-20, -1.237225e-19,
-1.327078e-19, -9.555147e-20, -9.974297e-20, -1.263039e-19, -1.231685e-19,
-1.095610e-19, -9.945322e-20, -1.167297e-19, -1.377522e-19, -1.112292e-19,
-9.703804e-20, -1.269954e-19, -1.329487e-19, -1.165994e-19, -1.072775e-19,
-1.136376e-19, -1.377926e-19, -1.262868e-19, -1.003840e-19, -1.220641e-19,
-1.390319e-19, -1.237995e-19, -1.124683e-19, -1.158642e-19, -1.369926e-19,
-1.383615e-19, -1.102297e-19, -1.156203e-19, -1.418664e-19, -1.327874e-19,
-1.159085e-19, -1.204101e-19, -1.341351e-19, -1.417579e-19, -1.232888e-19,
-1.143995e-19, -1.418758e-19, -1.447648e-19, -1.216763e-19, -1.225478e-19,
-1.362146e-19, -1.443033e-19, -1.338525e-19, -1.179164e-19, -1.353185e-19,
-1.515149e-19, -1.306903e-19, -1.225497e-19, -1.386557e-19, -1.475238e-19,
-1.415974e-19, -1.249914e-19, -1.316616e-19, -1.536468e-19, -1.414634e-19,
-1.234540e-19, -1.368604e-19, -1.505507e-19, -1.468245e-19, -1.340398e-19,
-1.304109e-19, -1.520221e-19, -1.530901e-19, -1.286235e-19, -1.363045e-19,
-1.522607e-19, -1.493091e-19, -1.412931e-19, -1.332974e-19, -1.465162e-19,
-1.577969e-19, -1.379577e-19, -1.337724e-19, -1.522043e-19, -1.539533e-19,
-1.461628e-19, -1.378909e-19, -1.415126e-19, -1.592053e-19, -1.482227e-19,
-1.308380e-19, -1.477073e-19, -1.571726e-19, -1.478227e-19, -1.410348e-19,
-1.400833e-19, -1.561738e-19, -1.559077e-19, -1.334728e-19, -1.427158e-19,
-1.566671e-19, -1.492981e-19, -1.427682e-19, -1.368902e-19, -1.481425e-19,
-1.578390e-19, -1.378210e-19, -1.351731e-19, -1.526478e-19, -1.510150e-19,
-1.425733e-19, -1.357135e-19, -1.411579e-19, -1.531527e-19, -1.398638e-19,
-1.292392e-19, -1.424617e-19, -1.473516e-19, -1.411649e-19, -1.343444e-19,
-1.315535e-19, -1.466359e-19, -1.459164e-19, -1.228090e-19, -1.330181e-19,
-1.457011e-19, -1.363051e-19, -1.315827e-19, -1.237107e-19, -1.365527e-19,
-1.449662e-19, -1.198327e-19, -1.231824e-19, -1.389560e-19, -1.332499e-19,
-1.286105e-19, -1.173818e-19, -1.242258e-19, -1.410483e-19, -1.197838e-19,
-1.108988e-19, -1.301758e-19, -1.290249e-19, -1.240704e-19, -1.160838e-19,
-1.119001e-19, -1.323968e-19, -1.234686e-19, -1.021053e-19, -1.181783e-19,
-1.228653e-19, -1.153920e-19, -1.112189e-19, -1.008536e-19, -1.194067e-19,
-1.250253e-19, -9.487268e-20, -1.040607e-19, -1.195762e-19, -1.080479e-19,
-1.060575e-19, -9.358954e-20, -1.017157e-19, -1.211297e-19, -9.084074e-20,
-8.612388e-20, -1.114390e-19, -1.019039e-19, -9.687924e-20, -8.928524e-20,
-8.520365e-20, -1.121607e-19, -9.359128e-20, -6.878130e-20, -9.784083e-20,
-9.605598e-20, -8.351205e-20, -8.167153e-20, -6.806387e-20, -9.443200e-20,
-9.401385e-20, -5.572741e-20, -7.703969e-20, -9.043602e-20, -7.168047e-20,
-7.088806e-20, -5.797527e-20, -7.102046e-20, -8.901315e-20, -4.884685e-20,
-5.103756e-20, -8.160983e-20, -6.009376e-20, -5.510217e-20, -5.202884e-20,
-4.689791e-20, -7.523026e-20, -4.955643e-20, -2.432093e-20, -6.313601e-20,
-5.509438e-20, -3.467579e-20, -4.052731e-20, -2.848755e-20, -5.181879e-20,
-4.909956e-20, -5.242156e-21, -3.760181e-20, -4.948894e-20, -1.682522e-20,
-2.486526e-20, -1.237537e-20, -2.345092e-20, -4.192363e-20, 7.770166e-21,
-2.921530e-21, -3.914425e-20, -6.809228e-21, -2.273970e-22, -1.374939e-21,
6.252475e-22, -2.507609e-20, 9.191103e-21, 3.091742e-20, -1.767158e-20,
-1.181151e-21, 2.811813e-20, 1.382409e-20, 2.007406e-20, 2.775842e-21,
1.186018e-20, 5.417520e-20, 1.471539e-20, 3.081713e-21, 4.729872e-20,
3.837933e-20, 3.737884e-20, 3.153345e-20, 2.311032e-20, 6.971707e-20,
5.188612e-20, 1.505386e-20, 6.047340e-20, 6.692094e-20, 5.274682e-20,
5.813602e-20, 4.297955e-20, 7.710948e-20, 8.868364e-20, 3.915145e-20,
6.683599e-20, 9.713614e-20, 7.449101e-20, 7.759738e-20, 6.955094e-20,
8.354021e-20, 1.156234e-19, 7.370408e-20, 6.867382e-20, 1.193924e-19,
1.047381e-19, 9.159654e-20, 9.743384e-20, 9.743372e-20, 1.325263e-19,
1.115656e-19, 7.863042e-20, 1.313365e-19, 1.358686e-19, 1.082960e-19,
1.175570e-19, 1.160883e-19, 1.431050e-19, 1.438651e-19, 1.008297e-19,
1.345771e-19, 1.655341e-19, 1.328683e-19, 1.301605e-19, 1.389552e-19,
1.524742e-19, 1.675048e-19, 1.289464e-19, 1.354898e-19, 1.849051e-19,
1.597434e-19, 1.440003e-19, 1.593961e-19, 1.666838e-19, 1.849686e-19,
1.586016e-19, 1.435977e-19, 1.933464e-19, 1.906335e-19, 1.564120e-19,
1.709711e-19, 1.856464e-19, 1.946904e-19, 1.861824e-19, 1.610723e-19,
1.955836e-19, 2.165679e-19, 1.796498e-19, 1.803495e-19, 1.989613e-19,
2.101762e-19, 2.072034e-19, 1.784903e-19, 1.991917e-19, 2.348498e-19,
2.062987e-19, 1.904561e-19, 2.126083e-19, 2.264998e-19, 2.251974e-19,
2.025668e-19, 2.062882e-19, 2.454724e-19, 2.332789e-19, 2.029378e-19,
2.213773e-19, 2.395062e-19, 2.417533e-19, 2.238961e-19, 2.137861e-19,
2.525315e-19, 2.558973e-19, 2.205811e-19, 2.292670e-19, 2.515364e-19,
2.565339e-19, 2.400900e-19, 2.257273e-19, 2.560058e-19, 2.725079e-19,
2.421196e-19, 2.351796e-19, 2.591491e-19, 2.719137e-19, 2.585317e-19,
2.365420e-19, 2.577037e-19, 2.846470e-19, 2.590180e-19, 2.426012e-19,
2.639362e-19, 2.788958e-19, 2.733387e-19, 2.513131e-19, 2.575350e-19,
2.916713e-19, 2.786648e-19, 2.500758e-19, 2.650626e-19, 2.847122e-19,
2.839134e-19, 2.628791e-19, 2.571955e-19, 2.927132e-19, 2.938394e-19,
2.588814e-19, 2.652625e-19, 2.893221e-19, 2.903099e-19, 2.738950e-19,
2.599750e-19, 2.865421e-19, 3.019929e-19, 2.673256e-19, 2.629820e-19,
2.888608e-19, 2.933612e-19, 2.817056e-19, 2.637571e-19, 2.788106e-19,
3.048323e-19, 2.788061e-19, 2.606853e-19, 2.828429e-19, 2.924942e-19,
2.862332e-19, 2.667304e-19, 2.678862e-19, 3.024944e-19, 2.874556e-19,
2.571292e-19, 2.764890e-19, 2.909865e-19, 2.847548e-19, 2.690207e-19,
2.611615e-19, 2.887387e-19, 2.913695e-19, 2.558271e-19, 2.614998e-19,
2.872132e-19, 2.814451e-19, 2.664687e-19, 2.567160e-19, 2.730961e-19,
2.902957e-19, 2.570367e-19, 2.465262e-19, 2.766206e-19, 2.753174e-19,
2.592499e-19, 2.495755e-19, 2.562682e-19, 2.806366e-19, 2.615175e-19,
2.316007e-19, 2.583418e-19, 2.714038e-19, 2.492549e-19, 2.406395e-19,
2.417906e-19, 2.605452e-19, 2.577936e-19, 2.210727e-19, 2.338546e-19,
2.608046e-19, 2.403926e-19, 2.262316e-19, 2.305648e-19, 2.397742e-19,
2.469792e-19, 2.175188e-19, 2.077382e-19, 2.425898e-19, 2.329657e-19,
2.069735e-19, 2.143061e-19, 2.194400e-19, 2.285294e-19, 2.133297e-19,
1.864139e-19, 2.154203e-19, 2.269710e-19, 1.930457e-19, 1.913232e-19,
2.025429e-19, 2.054707e-19, 2.011412e-19, 1.737462e-19, 1.836337e-19,
2.111211e-19, 1.836483e-19, 1.675181e-19, 1.828064e-19, 1.859980e-19,
1.848755e-19, 1.621026e-19, 1.546185e-19, 1.881374e-19, 1.741728e-19,
1.421734e-19, 1.597219e-19, 1.676103e-19, 1.608996e-19, 1.510643e-19,
1.332364e-19, 1.552079e-19, 1.641353e-19, 1.257342e-19, 1.288937e-19,
1.497663e-19, 1.378632e-19, 1.278180e-19, 1.154732e-19, 1.223511e-19,
1.425941e-19, 1.137969e-19, 9.652568e-20, 1.227916e-19, 1.190761e-19,
1.038825e-19, 9.724877e-20, 9.035958e-20, 1.123944e-19, 1.025389e-19,
6.607216e-20, 9.099100e-20, 1.012962e-19, 7.489540e-20
])

print("=== RAW OUTLIER ANALYSIS ===")
print(f"Data points: {len(raw_data)}")
print(f"Mean: {np.mean(raw_data):.2e}")
print(f"STD: {np.std(raw_data):.2e}")
print(f"Min: {np.min(raw_data):.2e}")
print(f"Max: {np.max(raw_data):.2e}")

# Compare with average noise STD from earlier
avg_noise_std = 2.092991e-19  # From eta_variation.txt
ratio = np.std(raw_data) / avg_noise_std
print(f"\nRatio to average STD: {ratio:.2f}x")

# Check for extreme values
threshold = 5 * avg_noise_std
extremes = np.where(np.abs(raw_data) > threshold)[0]
print(f"\nExtreme values (>5σ = {threshold:.2e}):")
print(f"Number: {len(extremes)}")
if len(extremes) > 0:
    print("First 5 extremes:")
    for i in extremes[:5]:
        print(f"  Sample {i}: {raw_data[i]:.2e} ({np.abs(raw_data[i])/avg_noise_std:.1f}σ)")

# Check trend
from scipy import stats
slope, intercept, r_value, p_value, std_err = stats.linregress(np.arange(len(raw_data)), raw_data)
print(f"\nLinear trend:")
print(f"  Slope: {slope:.2e} (per sample)")
print(f"  R²: {r_value**2:.3f}")
print(f"  p-value: {p_value:.3e}")

# Save the actual STD of this chunk
actual_std = np.std(raw_data)
with open('outlier_std_corrected.txt', 'w') as f:
    f.write(f"actual_std:{actual_std:.6e}\n")
    f.write(f"ratio_to_avg:{ratio:.6f}\n")
    f.write(f"n_extremes:{len(extremes)}\n")
    f.write(f"trend_slope:{slope:.6e}\n")
    f.write(f"trend_p:{p_value:.6e}\n")

print(f"\nSaved to 'outlier_std_corrected.txt'")
